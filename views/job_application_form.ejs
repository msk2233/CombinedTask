<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<link href="/form.css" rel="stylesheet">
<script src="/job_form_script.js"></script>

<body onload="state()">
    <div class="response">
        <h1 id="response"></h1>
    </div>
    <form id="regForm">
        <input type="text" name="id" id="id" style="visibility: hidden;">
        <h1>Job Application Form:</h1>
        <!-- One "tab" for each step in the form: -->
        <div class="tab">
            <table id="basicdetailtable" name="basicdetails" class="basicdetailtable">
                <th colspan="3">
                    <h2>Basic Detail</h2>
                </th>
                <tr>
                    <td>
                        <div id="firstname">First Name
                            <input type="text" id="fname" name="fname" class="req">
                            <p id="fnameerror" class="error-message"></p>
                    </td>
                    &nbsp;
                    <td>
                        <div id="lastname">Last Name<input type="text" id="lname" name="lname" class="req">
                            <p id="lnameerror" class="error-message"></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div>Designation <input type="text" id="designation" name="designation" class="req">
                            </p>
                            <p id="designationerror" class="error-message"></p>
                    </td>
                    <td rowspan="2">
                        Address 1<textarea rows="2" ,cols="5" name="address1" id="address1" class="req"></textarea>
                        <p id="address1error" class="error-message"></p>
                    </td>
                    <td rowspan="2"> Address 2
                        <textarea rows="2" ,cols="5" name="address2" id="address2" class="req"></textarea>
                        <p id="address2error" class="error-message"></p>
                    </td>
                </tr>
                <tr>
                    <td>Email <input type="text" id="email" name="email" class="req">
                        <p id="emailerror" class="error-message"></p>
                    </td>

                </tr>
                <tr>
                    <td>Ph Number <input name="phno" id="phonenumber" class="req">
                        <p id="phonenumbererror" class="error-message"></p>
                    </td>
                    <td> State
                        <select name="state" id="state" onchange="selectcity(this.value)">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Gender <input type="radio" name="gender" value="Male" checked>Male<input type="radio"
                            name=gender value="Female">Female</td>
                    <td>
                        City <select name="city" id="city" class="req"></select>
                        <p id="cityerror" class="error-message"></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        Relationship Status
                        <select id=rstatus name="rstatus">
                            <option value="single">Single</option>
                            <option value="Married">Married</option>
                        </select>
                    </td>
                    <td>Zip Code <input type="text" id="zipcode" name="zipcode" class="req">
                        <p id="zipcodeerror" class="error-message"></p>
                    </td>
                </tr>
                <tr>
                    <td>Date Of Birth <input id="dob" name="dob" placeholder="yyyy-mm-dd" class="req">
                        <p id="doberror" class="error-message"></p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="tab">
            <table name="education">
                <th colspan="4">
                    <h2>Education</h2>
                </th>
                <tr>
                    <td>SSC result</td>
                </tr>
                <tr>
                    <td>Name of the board
                        <input type="text" name="nob_ssc" id="nob_ssc"><span class="requiredssc" id="p_req"
                            style="margin-left: 5px;"></span>
                    </td>
                    <td>Passing Year
                        <input type="text" name="ps_ssc" id="ps_ssc"><span class="requiredssc" id="p_req"
                            style="margin-left: 5px;"></span>
                    </td>
                    <td>Percentage
                        <input type="text" name="percentage_ssc" id="tage_ssc"><span class="requiredssc" id="p_req"
                            style="margin-left: 5px;"></span>
                    </td>
                </tr>

                <tr>
                    <td>HSC RESULT</td>
                </tr>
                <tr>
                    <td>Name of the board
                        <input type="text" name="nob_hsc" id="nob_hsc"><span class="requiredhsc"
                            style="margin-left: 5px;"></span>
                    </td>
                    <td>Passing Year
                        <input type="text" name="ps_hsc" id="ps_hsc"><span class="requiredhsc"
                            style="margin-left: 5px;"></span>
                    </td>
                    <td>Percentage
                        <input type="text" name="percentage_hsc" id="tage_hsc"><span class="requiredhsc"
                            style="margin-left: 5px;"></span>
                    </td>
                </tr>

                <TR>
                    <TD> BACHELOR DEGREE</TD>
                </TR>
                <tr>
                    <td>
                        Course Name <input type="text" name="coursename_bach" id="coursename_bach">
                        <span class="requiredbech" style="margin-left: 5px;"></span>
                    </td>
                    <td>
                        Passing Year <input type="text" name="ps_bach" id="ps_bach">
                        <span class="requiredbech" style="margin-left: 5px;"></span>
                    </td>
                    <td>
                        Percentage <input type="text" name="percentage_bach" id="tage_bach">
                        <span class="requiredbech" style="margin-left: 5px;"></span>
                    </td>
                </tr>

                <TR>
                    <TD> MASTER DEGREE</TD>
                </TR>
                <tr>
                    <td>
                        Course Name <input type="text" name="coursename_mas" id="coursename_mas">
                        <span class="requiredmas" style="margin-left: 5px;"></span>
                    </td>
                    <td>
                        Passing Year <input type="text" name="ps_mas" id="ps_mas">
                        <span class="requiredmas" style="margin-left: 5px;"></span>
                    </td>
                    <td>
                        Percentage <input type="text" name="percentage_mas" id="tage_mas">
                        <span class="requiredmas" style="margin-left: 5px;"></span>
                    </td>
                </tr>
            </table>
        </div>
        <div class="tab">
            <table name="work Experience">
                <th colspan="4">
                    <h2>Work Experience</h2>
                </th>
                <tr>
                    <td id="td_companyname1"> Company name <input type="text" name="companyname1" id="companyname1">
                        <span class="required_exp1"></span>
                    </td>
                    <td id="td_designation_exp1"> Designation <input type="text" name="designation_exp1"
                            id="designation_exp1">
                        <span class="required_exp1"></span>
                    </td>
                    <td id="td_date_of_join_exp1"> From <input type="text" name="date_of_join_exp1"
                            id="date_of_join_exp1">
                        <span class="required_exp1"></span>
                    </td>
                    <td id="td_date_of_coplition_exp1"> To <input type="text" name="date_of_coplition_exp1"
                            id="date_of_coplition_exp1">
                        <span class="required_exp1"></span>
                    </td>
                </tr>
                <tr>
                    <td id="td_companyname2"> Company name <input type="text" name="companyname2" id="companyname2">
                        <span class="required_exp2" style="margin-left: 5px;"></span></td>
                    <td id="td_designation_exp2"> Designation <input type="text" name="designation_exp2"
                            id="designation_exp2"> <span class="required_exp2" style="margin-left: 5px;"></span></td>
                    <td id="td_date_of_join_exp2"> From <input type="text" id="date_of_join_exp2"
                            name="date_of_join_exp2"> <span class="required_exp2" style="margin-left: 5px;"></span></td>
                    <td id="td_date_of_coplition_exp2"> To <input type="text" id="date_of_coplition_exp2"
                            name="date_of_coplition_exp2"> <span class="required_exp2" style="margin-left: 5px;"></span>
                    </td>
                </tr>
                <tr>
                    <td id="td_companyname3"> Company name <input type="text" id="companyname3"
                            name="companyname3"><span class="required_exp3" style="margin-left: 5px;"></span> </td>
                    <td id="td_designation_exp3"> Designation <input type="text" id="designation_exp3"
                            name="designation_exp3"><span class="required_exp3" style="margin-left: 5px;"></span> </td>
                    <td id="td_date_of_join_exp3"> From <input type="text" id="date_of_join_exp3"
                            name="date_of_join_exp3"><span class="required_exp3" style="margin-left: 5px;"></span> </td>
                    <td id="td_date_of_coplition_exp3"> To <input type="text" id="date_of_coplition_exp3"
                            name="date_of_coplition_exp3">
                    </td>
                </tr>
            </table>

        </div>
        <div class="tab">
            <table class="joint">
                <tr>
                    <td>
                        <table class="languagetable" name="language" style="margin-right: 200px;">
                            <th>Known language</th>
                            <tr>
                                <td>
                                    Hindi
                                </td>
                                <td> <input type="checkbox" id="rhindi" name="rhindi"> read</td>
                                <td> <input type="checkbox" id="whindi" name="whindi"> Write </td>
                                <td> <input type="checkbox" id="shindi" name="shindi"> Speak</td>
                            </tr>
                            <tr>
                                <td>
                                    English
                                </td>
                                <td> <input type="checkbox" name="renglish" id="renglish"> read </td>
                                <td><input type="checkbox" name="wenglish" id="wenglish"> Write </td>
                                <td> <input type="checkbox" name="senglish" id="senglish"> Speak </td>
                            </tr>
                            <tr>
                                <td>
                                    Gujarati
                                </td>
                                <td> <input type="checkbox" name="rgujarati" id="rgujarati"> read </td>
                                <td> <input type="checkbox" name="wgujarati" id="wgujarati"> Write </td>
                                <td> <input type="checkbox" name="sgujarati" id="sgujarati"> Speak </td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table class="techtable" name="technology">
                            <th>Technologies you know</th>
                            <tr>
                                <td>
                                    <input type="checkbox" id="phpcheckbox" name="phpcheckbox"
                                        onclick="enableradio(this)"> PHP
                                </td>
                                <td> <input type="radio" name="php" id="Beginer1" value="Beginer" disabled> Beginer</td>
                                <td><input type="radio" name="php" id="Mideator1" value="Mideator" disabled>Mideator
                                </td>
                                <td><input type="radio" name="php" id="Expert1" value="Expert" disabled>Expert
                            </tr>
                    </td>
                <tr>
                    <td>
                        <input type="checkbox" id="mysqlcheckbox" name="mysqlcheckbox" onclick="enableradio(this)">
                        Mysql
                    </td>
                    <td> <input type="radio" name="mysql" value="Beginer" id="Beginer2" disabled> Beginer</td>
                    <td> <input type="radio" name="mysql" value="Mideator" id="Mideator2" disabled>Mideator</td>
                    <td> <input type="radio" name="mysql" value="Expert" id="Expert2" disabled>Expert

                    </td>
                </tr>
                <tr>
                    <td>

                        <input type="checkbox" id="laravelcheckbox" name="laravelcheckbox" onclick="enableradio(this)">
                        laravel
                    </td>
                    <td> <input type="radio" name="laravel" id="Beginer3" value="Beginer" disabled> Beginer</td>
                    <td> <input type="radio" name="laravel" id="Mideator3" value="Mideator" disabled>Mideator</td>
                    <td> <input type="radio" name="laravel" id="Expert3" value="Expert" disabled>Expert

                    </td>
                </tr>
                <tr>
                    <td>

                        <input type="checkbox" id="oraclecheckbox" name="oraclecheckbox" onclick="enableradio(this)">
                        Oracle
                    </td>
                    <td> <input type="radio" name="oracle" id="Beginer4" value="Beginer" disabled> Beginer</td>
                    <td> <input type="radio" name="oracle" id="Mideator4" value="Mideator" disabled>Mideator</td>
                    <td> <input type="radio" name="oracle" id="Expert4" value="Expert" disabled>Expert

                    </td>
                </tr>
            </table>
            </td>
            </tr>
            </table>

        </div>
        <div class="tab">
            <table name="Referance contact">
                <th colspan="3">Referance contact</th>
                <tr>
                    <td> Name <input type="text" name="ref_name_1" id="ref_name_1"> </td>
                    <td>Contact Number <input type="text" name="contact_ref_1" id="contact_ref_1"></td>
                    <td>Relation <input type="text" name="contact_ref_relation1" id="contact_ref_relation_1">
                    </td>
                </tr>
                <tr>
                    <td> Name <input type="text" name="ref_name_2" id="ref_name_2"> </td>
                    <td>Contact Number <input type="text" name="contact_ref_2" id="contact_ref_2"></td>
                    <td>Relation <input type="text" name="contact_ref_relation2" id="contact_ref_relation_2">
                    </td>
                </tr>
            </table>
        </div>
        <div class="tab">
            <table name="Preferances">
                <th colspan="5">Preferances </th>
                <tr>
                    <td rowspan="3">Prefered Location</td>
                    <td><select multiple name="location[]">
                            <option value="Ahmedabad">Ahmedabad</option>
                            <option value="Bhavnagar">Bhavnagar</option>
                            <option value="Rajkot">Rajkot</option>
                        </select></td>
                    <td>
                        <table class="notice">
                            <tr>
                                <td> Notice period <input type="text" name="notice_period" id="notice_prd">
                                </td>
                            </tr>
                            <tr>
                                <td> Expected ctc <input type="text" name="exp_ctc" id="exp_ctc"></td>
                            </tr>
                            <tr>
                                <td>
                                    Current ctc <input type="text" name="cur_ctc" id="cur_ctc">
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td rowspan="3">
                    </td>
                    <td> department
                        <select name="department" id="department">
                            <option id="development" value="development">development</option>
                            <option id="marketing" value="marketing">marketing</option>
                        </select>
                    </td>
                </tr>
            </table>
        </div>
        <button type="button" id="submitbtn" onclick="submitdata();">SUBMIT</button>

    </form>
    <script>
        let submittype = '<%= submittype %>';
        let id = '<%= id %>';
    
        async function fetchData(id) {
            try {
                let response = await fetch(`${location.origin}/fetch/?id=${id}`);
                let data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
    
        function populateBasicDetails(data) {
            let basicInputs = document.getElementById('basicdetailtable').getElementsByTagName('input');
            for (let input of basicInputs) {
                input.value = data.result1[0][input.name] || '';
            }
    
            let genderInputs = document.getElementsByName('gender');
            genderInputs[0].checked = data.result1[0].gender === 'Male';
            genderInputs[1].checked = data.result1[0].gender === 'Female';
    
            let rstatusInputs = document.getElementsByName('rstatus');
            rstatusInputs[0].selected = data.result1[0].rstatus === 'single';
            rstatusInputs[1].selected = data.result1[0].rstatus !== 'single';
    
            document.getElementById('address1').value = data.result1[0].address1 || '';
            document.getElementById('address2').value = data.result1[0].address2 || '';
        }
    
        function populateEducationDetails(data) {
            let educationDetails = ['ssc', 'hsc', 'bach', 'mas'];
            educationDetails.forEach((level, index) => {
                if (data.result2[index]) {
                    document.getElementById(`nob_${level}`).value = data.result2[index].board_course || '';
                    document.getElementById(`ps_${level}`).value = data.result2[index].passing_year || '';
                    document.getElementById(`tage_${level}`).value = data.result2[index].percentage || '';
                }
            });
        }
    
        function populateWorkExperience(data) {
            let workExperienceCount = Math.min(data.result3.length, 3);
            for (let i = 0; i < workExperienceCount; i++) {
                let experience = data.result3[i];
                if (experience) {
                    document.getElementById(`companyname${i + 1}`).value = experience.ComapanyName || '';
                    document.getElementById(`designation_exp${i + 1}`).value = experience.Designation || '';
                    document.getElementById(`date_of_join_exp${i + 1}`).value = experience.Dateofjoining || '';
                    document.getElementById(`date_of_coplition_exp${i + 1}`).value = experience.Dateofcompliting || '';
                }
            }
    
            // Hide additional rows if less than 3 experiences
            for (let i = workExperienceCount; i < 3; i++) {
                document.getElementById(`td_companyname${i + 1}`).style.visibility = 'hidden';
                document.getElementById(`td_designation_exp${i + 1}`).style.visibility = 'hidden';
                document.getElementById(`td_date_of_join_exp${i + 1}`).style.visibility = 'hidden';
                document.getElementById(`td_date_of_coplition_exp${i + 1}`).style.visibility = 'hidden';
            }
        }
    
        function populateLanguages(data) {
            data.result4.forEach((language, index) => {
                if (index === 0) {
                    document.getElementById('rhindi').checked = language.can_read === 1;
                    document.getElementById('whindi').checked = language.can_write === 1;
                    document.getElementById('shindi').checked = language.can_speak === 1;
                } else if (index === 1) {
                    document.getElementById('renglish').checked = language.can_read === 1;
                    document.getElementById('wenglish').checked = language.can_write === 1;
                    document.getElementById('senglish').checked = language.can_speak === 1;
                } else if (index === 2) {
                    document.getElementById('rgujarati').checked = language.can_read === 1;
                    document.getElementById('wgujarati').checked = language.can_write === 1;
                    document.getElementById('sgujarati').checked = language.can_speak === 1;
                }
            });
        }
    
        function populateTechnologies(data) {
            data.result5.forEach((tech, index) => {
                let checkbox = document.getElementById(`${tech.Name_of_technology.toLowerCase()}checkbox`);
                if (checkbox) {
                    checkbox.checked = true;
                    let radios = document.getElementsByName(tech.Name_of_technology.toLowerCase());
                    radios.forEach(radio => {
                        radio.disabled = !checkbox.checked;
                        if (tech.Experties === radio.value) {
                            document.getElementById(`${radio.value}${index + 1}`).checked = true;
                        }
                    });
                }
            });
        }
    
        function populateReferences(data) {
            data.result6.forEach((ref, index) => {
                if (index < 2) {
                    document.getElementById(`ref_name_${index + 1}`).value = ref.NameOfContact || '';
                    document.getElementById(`contact_ref_${index + 1}`).value = ref.ContactNumber || '';
                    document.getElementById(`contact_ref_relation_${index + 1}`).value = ref.Relation || '';
                }
            });
        }
    
        function populatePreferences(data) {
            document.getElementById('notice_prd').value = data.result7[0].notice_period || '';
            document.getElementById('exp_ctc').value = data.result7[0].expected_ctc || '';
            document.getElementById('cur_ctc').value = data.result7[0].curr_ctc || '';
    
            let departmentOptions = document.getElementById('department').getElementsByTagName('option');
            for (let option of departmentOptions) {
                if (option.value === data.result7[0].department) {
                    option.selected = true;
                }
            }
        }
    
        async function initializeForm() {
            if (submittype === 'update') {
                document.getElementById('id').value = id;
                let data = await fetchData(id);
    
                populateBasicDetails(data);
                populateEducationDetails(data);
                populateWorkExperience(data);
                populateLanguages(data);
                populateTechnologies(data);
                populateReferences(data);
                populatePreferences(data);
            }
        }
    
        async function submitdata() {
            validate();
            if (validate()) {
                let form = document.getElementById('regForm');
                const formData = new URLSearchParams(new FormData(form)).toString();
                let url = submittype === 'insert' ? `${location.origin}/dashboard/job_application_form_main/post_data` : `${location.origin}/dashboard/job_application_form_main/update`;
    
                try {
                    let response = await fetch(url, {
                        method: 'POST',
                        body: formData,
                        headers: { 'Content-type': 'application/x-www-form-urlencoded' }
                    });
                    let result = await response.json();
    
                    if (result.fail === null) {
                        form.style.visibility = 'hidden';
                        document.getElementById('response').innerText = 'ERROR IN YOUR INPUT';
                    } else if (result.fail === 'no') {
                        form.style.visibility = 'hidden';
                        document.getElementById('response').innerText = submittype === 'insert' ? 'YOUR RESPONSE HAVE BEEN SUBMITTED' : 'YOUR DATA HAVE BEEN UPDATED';
                    }
                } catch (error) {
                    console.error('Error submitting data:', error);
                }
            }
        }
    
        async function state() {
            try {
                let response = await fetch(`${location.origin}/dashboard/job_application_form_main/get_state`);
                let states = await response.json();
    
                let stateSelect = document.getElementById('state');
                for (let key in states) {
                    for (let subKey in states[key]) {
                        let option = new Option(states[key][subKey].name, states[key][subKey].id);
                        option.setAttribute('name', 'statename');
                        stateSelect.appendChild(option);
                    }
                }
            } catch (error) {
                console.error('Error fetching states:', error);
            }
        }
    
        async function selectcity(id) {
            try {
                let response = await fetch(`${location.origin}/dashboard/job_application_form_main/get_city/?id=${id}`);
                let cities = await response.json();
    
                let citySelect = document.getElementById('city');
                citySelect.innerHTML = '';
                for (let key in cities) {
                    for (let subKey in cities[key]) {
                        let option = new Option(cities[key][subKey].city, cities[key][subKey].city);
                        option.setAttribute('name', 'cityname[]');
                        citySelect.appendChild(option);
                    }
                }
            } catch (error) {
                console.error('Error fetching cities:', error);
            }
        }
    
        function enableradio(check) {
            const radios = check.closest('tr').querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.disabled = !check.checked;
            });
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            if (submittype === 'update') {
                initializeForm();
            }
            state();
        });
    </script>
</body>

</html>